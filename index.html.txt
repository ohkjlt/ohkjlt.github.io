<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #fff5f5;
            overflow: hidden; /* Prevent scrollbars during the chase */
        }
        .cursive {
            font-family: 'Dancing+Script', cursive;
        }
        .heart-bg {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23feb2b2' d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            opacity: 0.1;
        }
        .fade-in {
            animation: fadeIn 1s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .hidden-card {
            display: none;
            opacity: 0;
        }
        #no-btn {
            transition: all 0.15s ease;
            z-index: 50;
            position: relative;
        }
        #yes-btn {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .meme-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 245, 245, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .meme-active {
            opacity: 1;
            pointer-events: auto;
        }
        /* Re-enable scrolling for the itinerary page */
        .allow-scroll {
            overflow-y: auto !important;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="fixed inset-0 heart-bg pointer-events-none"></div>

    <!-- PAGE 1: THE INVITATION -->
    <div id="invite-card" class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl text-center max-w-md w-full relative z-10 fade-in">
        <div class="text-6xl mb-6 floating">üíù</div>
        <h1 class="cursive text-4xl md:text-5xl text-rose-500 mb-4">Will you spend Valentines with me?</h1>
        <p class="text-gray-600 mb-8 italic">Miles apart, but always in my heart. I've planned a virtual night for us...</p>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center min-h-[120px]">
            <button id="yes-btn" class="bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-10 rounded-full shadow-lg transform active:scale-95 text-xl z-20">
                Yes!
            </button>
            <button id="no-btn" class="bg-gray-200 text-gray-500 font-bold py-2 px-6 rounded-full whitespace-nowrap">
                No
            </button>
        </div>
    </div>

    <!-- CELEBRATORY MEME OVERLAY -->
    <div id="meme-overlay" class="meme-overlay">
        <h2 class="cursive text-4xl text-rose-600 mb-6 text-center px-4">YAYYYY! BEST NEWS EVER!</h2>
        <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZ2lmc3hia201ejR2MnU4czRjcWlpdzV3ZHdieWJqa2gwbHNtbGpmMSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/t3sZxY5zS5B0z5zMIz/giphy.gif" alt="Happy Cat Meme" class="rounded-2xl shadow-xl max-w-[300px] mb-6">
        <p class="text-rose-400 animate-pulse font-bold">Initializing the best day ever...</p>
    </div>

    <!-- PAGE 2: THE ITINERARY -->
    <div id="itinerary-card" class="hidden-card bg-white p-6 md:p-10 rounded-3xl shadow-2xl max-w-2xl w-full relative z-10 my-8">
        <div class="text-center mb-10">
            <span class="text-rose-500 text-sm font-bold uppercase tracking-widest">February 14th, 2026</span>
            <h2 class="cursive text-5xl text-rose-600 mt-2">Itinerary of the Night</h2>
            <div class="h-1 w-24 bg-rose-200 mx-auto mt-4 rounded-full"></div>
            <p class="text-gray-400 text-sm mt-3 italic">Connecting across the distance~</p>
        </div>

        <div class="space-y-8">
            <div class="flex items-start gap-4 fade-in" style="animation-delay: 0.2s">
                <div class="bg-rose-100 p-3 rounded-2xl text-2xl">üçï</div>
                <div>
                    <h3 class="font-bold text-rose-700 text-lg"> 8:00 PM ‚Äî Dinner (or Breakfast if you haven't eaten yet)</h3>
                    <p class="text-gray-600">We both order our favorite food or we can order surprise food for each other via Uber Eats!</p>
                </div>
            </div>

            <div class="flex items-start gap-4 fade-in" style="animation-delay: 0.4s">
                <div class="bg-rose-100 p-3 rounded-2xl text-2xl">üíª</div>
                <div>
                    <h3 class="font-bold text-rose-700 text-lg">9:00 PM ‚Äî Candlelit Facetime</h3>
                    <p class="text-gray-600">Dress up in night wear, light a candle, and enjoy our dinner together over video call. It's almost like being there!</p>
                </div>
            </div>

            <div class="flex items-start gap-4 fade-in" style="animation-delay: 0.6s">
                <div class="bg-rose-100 p-3 rounded-2xl text-2xl">üé¨</div>
                <div>
                    <h3 class="font-bold text-rose-700 text-lg">10:00 PM ‚Äî Show Time!</h3>
                    <p class="text-gray-600"> Binge Studio Ghibli Films in bed or another show together. You've mentioned rewatching them for a while!</p>
                </div>
            </div>

            <div class="flex items-start gap-4 fade-in" style="animation-delay: 0.8s">
                <div class="bg-rose-100 p-3 rounded-2xl text-2xl">üìú</div>
                <div>
                    <h3 class="font-bold text-rose-700 text-lg">12:00 AM ‚Äî The Finale</h3>
                    <p class="text-gray-600"> The day will end and we'll say good bye!</p>
                </div>
            </div>
        </div>


        <!-- SUGGESTIONS SECTION -->
        <div class="mt-12 pt-8 border-t border-rose-100">
            <h3 class="cursive text-2xl text-rose-600 mb-4">Any special requests?</h3>
            <div class="relative">
                <textarea id="suggestion-box" placeholder="Write something you'd like to change to our night..." class="w-full p-4 rounded-2xl border-2 border-rose-100 focus:border-rose-300 focus:outline-none text-gray-600 transition h-24 bg-rose-50/30"></textarea>
                <button id="send-suggestion" class="mt-3 bg-rose-400 hover:bg-rose-500 text-white font-bold py-2 px-6 rounded-full text-sm transition transform active:scale-95">
                    Save Request
                </button>
            </div>
            <p id="thank-you-msg" class="hidden text-rose-500 text-sm mt-3 animate-bounce">Saved! Hopefully, but let me know in case it doesn't work. </p>
        </div>

        <!-- ADMIN VIEW PANEL (HIDDEN BY DEFAULT) -->
        <div id="admin-panel" class="hidden mt-8 p-6 bg-gray-50 rounded-2xl border border-gray-200">
            <h3 class="font-bold text-gray-700 mb-4">Her Suggestions:</h3>
            <div id="suggestion-list" class="space-y-2 text-sm text-gray-600 italic">
                <!-- Suggestions will appear here -->
                No suggestions yet.
            </div>
        </div>

        <div class="mt-12 text-center">
            <p class="cursive text-2xl text-rose-500 mb-4 italic"></p>
            <div class="flex flex-col items-center gap-4">
                <button onclick="window.print()" class="text-xs text-gray-400 hover:text-rose-400 transition underline">Save Our Plan</button>
                <button id="admin-trigger" class="text-[10px] text-gray-300 hover:text-rose-200 transition">Admin: View Request</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Firebase Configuration (Using provided environment variables)
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'valentine-app';

        // Elements
        const noBtn = document.getElementById('no-btn');
        const yesBtn = document.getElementById('yes-btn');
        const inviteCard = document.getElementById('invite-card');
        const memeOverlay = document.getElementById('meme-overlay');
        const itineraryCard = document.getElementById('itinerary-card');
        const suggestionBox = document.getElementById('suggestion-box');
        const sendBtn = document.getElementById('send-suggestion');
        const thankYou = document.getElementById('thank-you-msg');
        const adminTrigger = document.getElementById('admin-trigger');
        const adminPanel = document.getElementById('admin-panel');
        const suggestionList = document.getElementById('suggestion-list');

        let moveCount = 0;
        let yesScale = 1;

        // Auth
        async function startAuth() {
            try { await signInAnonymously(auth); } catch (e) { console.error("Auth failed", e); }
        }
        startAuth();

        function moveButton() {
            moveCount++;
            const padding = 20;
            const btnRect = noBtn.getBoundingClientRect();
            const maxX = window.innerWidth - btnRect.width - padding;
            const maxY = window.innerHeight - btnRect.height - padding;
            const newX = Math.max(padding, Math.random() * maxX);
            const newY = Math.max(padding, Math.random() * maxY);
            
            noBtn.style.position = 'fixed';
            noBtn.style.left = `${newX}px`;
            noBtn.style.top = `${newY}px`;
            noBtn.style.margin = '0';
            
            yesScale += 0.2;
            yesBtn.style.transform = `scale(${yesScale})`;

            const phrases = ["Nice try! ‚úàÔ∏è", "Miles can't stop us!", "Still No? ü•∫", "Just click YES!", "I'm faster than Wi-Fi!"];
            if (moveCount % 5 === 0) noBtn.innerText = phrases[Math.floor(Math.random() * phrases.length)];
        }

        noBtn.addEventListener('mouseover', moveButton);
        noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveButton(); });
        noBtn.addEventListener('click', (e) => { e.preventDefault(); moveButton(); });

        yesBtn.addEventListener('click', () => {
            noBtn.style.display = 'none';
            inviteCard.style.opacity = '0';
            
            setTimeout(() => {
                inviteCard.style.display = 'none';
                memeOverlay.classList.add('meme-active');
                createHearts();
                
                setTimeout(() => {
                    memeOverlay.classList.remove('meme-active');
                    setTimeout(() => {
                        memeOverlay.style.display = 'none';
                        document.body.classList.add('allow-scroll');
                        itineraryCard.style.display = 'block';
                        void itineraryCard.offsetWidth;
                        itineraryCard.style.opacity = '1';
                        itineraryCard.classList.add('fade-in');
                    }, 500);
                }, 3000);
            }, 300);
        });

        // CLOUD STORAGE: Save Suggestion
        sendBtn.addEventListener('click', async () => {
            const text = suggestionBox.value.trim();
            if (text !== "" && auth.currentUser) {
                sendBtn.disabled = true;
                sendBtn.innerText = "Saving...";
                
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'suggestions'), {
                        text: text,
                        timestamp: new Date()
                    });
                    
                    thankYou.classList.remove('hidden');
                    suggestionBox.disabled = true;
                    sendBtn.classList.add('hidden');
                } catch (e) {
                    alert("Error saving: " + e.message);
                    sendBtn.disabled = false;
                    sendBtn.innerText = "Save Suggestion";
                }
            }
        });

        // ADMIN: View Suggestions
        adminTrigger.addEventListener('click', async () => {
            const pw = prompt("Enter Admin Password:");
            if (pw === "love2026") {
                adminPanel.classList.toggle('hidden');
                if (!adminPanel.classList.contains('hidden')) {
                    suggestionList.innerHTML = "Loading...";
                    const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'suggestions'));
                    const snapshot = await getDocs(q);
                    suggestionList.innerHTML = "";
                    if (snapshot.empty) {
                        suggestionList.innerHTML = "No suggestions yet.";
                    } else {
                        snapshot.forEach(doc => {
                            const p = document.createElement('p');
                            p.className = "p-2 border-b border-gray-100 last:border-0";
                            p.innerText = `‚Ä¢ "${doc.data().text}"`;
                            suggestionList.appendChild(p);
                        });
                    }
                }
            } else {
                alert("Incorrect password!");
            }
        });

        function createHearts() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.innerHTML = ['‚ù§Ô∏è', 'üíñ', '‚ú®', 'üíï'][Math.floor(Math.random() * 4)];
                    heart.style.position = 'fixed';
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.top = '100vh';
                    heart.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    heart.style.zIndex = '200';
                    heart.style.transition = 'all 3s ease-out';
                    heart.style.pointerEvents = 'none';
                    document.body.appendChild(heart);
                    setTimeout(() => {
                        heart.style.transform = `translateY(-110vh) rotate(${Math.random() * 360}deg)`;
                        heart.style.opacity = '0';
                    }, 50);
                    setTimeout(() => { heart.remove(); }, 3050);
                }, i * 80);
            }
        }
    </script>
</body>
</html>